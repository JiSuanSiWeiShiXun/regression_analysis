# 题目5：健身数据回归分析报告

## 问题描述

通过测量参与体能课程的男性的各种心率和脉搏指标，预测氧气消耗率（测量困难且昂贵）。

### 变量说明
- **Y**: 氧气消耗量（ml/kg体重/分钟）
- **X₁**: 年龄（岁）
- **X₂**: 体重（公斤）
- **X₃**: 跑1.5英里的时间（分钟）
- **X₄**: 静息脉搏率
- **X₅**: 开始跑步时的脉搏率
- **X₆**: 跑步结束时的脉搏率

### 数据集
- **样本量**: 31个观测值
- **数据来源**: 体能课程测试数据

---

## (a) 多元线性回归模型

### 模型方程
```
Y = β₀ + β₁X₁ + β₂X₂ + β₃X₃ + β₄X₄ + β₅X₅ + β₆X₆ + ε
```

### 系数估计结果

| 参数 | 估计值 | 说明 |
|------|--------|------|
| β₀（截距） | 102.238339 | 基准氧气消耗量 |
| β₁（年龄） | -0.219916 | 年龄增加1岁，氧气消耗量减少0.22 ml/kg/min |
| β₂（体重） | -0.072380 | 体重增加1kg，氧气消耗量减少0.07 ml/kg/min |
| β₃（跑步时间） | **-2.680516** | **跑步时间增加1分钟，氧气消耗量减少2.68 ml/kg/min** |
| β₄（静息脉搏） | -0.000844 | 影响极小 |
| β₅（开始脉搏） | -0.373164 | 开始脉搏增加1次/分，氧气消耗量减少0.37 ml/kg/min |
| β₆（结束脉搏） | 0.304735 | 结束脉搏增加1次/分，氧气消耗量增加0.30 ml/kg/min |

### 模型统计量

| 统计量 | 数值 | 说明 |
|--------|------|------|
| **σ² (MSE)** | 5.391972 | 误差方差估计 |
| **RMSE** | 2.322062 | 均方根误差 |
| **R²** | 0.8480 | 模型解释了84.8%的变异 |
| **调整R²** | 0.8100 | 调整后的拟合优度 |
| **F统计量** | 22.3163 | 模型整体显著性强 |

### 关键发现

1. **最重要的预测变量是X₃（跑步时间）**：
   - 相关系数为-0.8622，呈强负相关
   - 跑步时间越短，体能越好，氧气消耗率越高
   - 这符合生理学预期：有氧能力强的人能更快跑完

2. **残差分析**：
   - Q-Q图显示残差近似正态分布
   - 残差图无明显模式，表明线性假设合理
   - 模型诊断良好

3. **多重共线性观察**：
   - X₅和X₆高度相关（r=0.9298），存在共线性
   - 这可能影响个别系数的解释

---

## (b) 线性模型的变量选择

### 前向选择结果

| 步骤 | 选入变量 | R² | AIC | BIC | Cp |
|------|---------|-----|-----|-----|-----|
| 0 | 无 | 0.0000 | 104.70 | 106.13 | 128.90 |
| 1 | X₃ | 0.7434 | 64.53 | 67.40 | 13.52 |
| 2 | X₃, X₁ | 0.7642 | 63.91 | 68.21 | 12.22 |
| 3 | X₃, X₁, X₅ | 0.8111 | 59.04 | 64.77 | 6.83 |
| 4 | **X₃, X₁, X₅, X₆** | **0.8368** | **56.50** | **63.67** | **4.77** |
| 5 | X₃, X₁, X₅, X₆, X₂ | 0.8480 | 56.30 | 64.90 | 5.00 |
| 6 | X₃, X₁, X₅, X₆, X₂, X₄ | 0.8480 | 58.30 | 68.34 | 7.00 |

### 后向消元结果

| 步骤 | 剩余变量 | R² | AIC | BIC | Cp |
|------|---------|-----|-----|-----|-----|
| 0 | 全部6个 | 0.8480 | 58.30 | 68.34 | 7.00 |
| 1 | 去除X₄ | 0.8480 | 56.30 | 64.90 | 5.00 |
| 2 | 去除X₄, X₂ | 0.8368 | 56.50 | 63.67 | 4.77 |
| 3 | 去除X₄, X₂, X₆ | 0.8111 | 59.04 | 64.77 | 6.83 |
| 4 | 去除X₄, X₂, X₆, X₅ | 0.7642 | 63.91 | 68.21 | 12.22 |
| 5 | 仅X₃ | 0.7434 | 64.53 | 67.40 | 13.52 |

### 最优模型选择

#### 根据不同准则的最优模型：

1. **AIC准则（最小化）**：
   - 前向选择：选择5个变量 (X₃, X₁, X₅, X₆, X₂)
   - 后向消元：选择5个变量 (X₁, X₂, X₃, X₅, X₆)
   - AIC = 56.30

2. **BIC准则（最小化，推荐）**：
   - 前向选择和后向消元一致：**选择4个变量 (X₃, X₁, X₅, X₆)**
   - BIC = 63.67
   - R² = 0.8368

3. **Mallows' Cp准则（接近p）**：
   - 选择步骤4的模型（4个变量）
   - Cp = 4.77 ≈ p = 5（包括截距）

### 推荐模型（简化版）

根据BIC准则平衡，最简洁有效的模型为：

```
Y = 88.4623 - 3.2040×X₃ - 0.1504×X₁
```

**仅使用2个变量：**
- **X₃（跑步时间）**：主要预测变量
- **X₁（年龄）**：次要预测变量
- **R² = 0.7642**（仍然解释76.4%的变异）
- **调整R² = 0.7474**

### 变量选择分析

**被选中的变量重要性排序：**
1. **X₃（跑步时间）** - 最重要，单独解释74.3%的变异
2. **X₁（年龄）** - 第二重要，增加2.1%的解释力
3. **X₅（开始脉搏）** - 增加4.7%的解释力
4. **X₆（结束脉搏）** - 增加2.6%的解释力

**被排除的变量：**
- **X₄（静息脉搏）** - 贡献极小，最先被排除
- **X₂（体重）** - 解释力有限

---

## (c) 二次回归模型

### 模型方程
```
Y = β₀ + Σβᵢxᵢ + ΣΣβᵢⱼxᵢxⱼ + ε  (i=1,...,6; j=i,...,6)
```

### 模型特征
- **线性项**：6个
- **二次项和交互项**：21个
- **总特征数**：27个
- **自由度**：31 - 27 - 1 = 3

### 系数估计结果

**线性项系数：**
- β₀（截距）= 331.985600
- β₁（X₁）= -14.319569
- β₂（X₂）= -2.656772
- β₃（X₃）= 57.055195
- β₄（X₄）= -6.654567
- β₅（X₅）= -33.801005
- β₆（X₆）= 33.561575

**重要的二次/交互项（按绝对值排序前10）：**

| 项 | 系数 | 解释 |
|----|------|------|
| **X₃²** | **-0.756858** | 跑步时间的二次效应最强 |
| **X₁×X₃** | **-0.534989** | 年龄与跑步时间的交互作用 |
| X₃×X₆ | 0.327401 | 跑步时间与结束脉搏的交互 |
| X₃×X₅ | -0.324001 | 跑步时间与开始脉搏的交互 |
| X₁×X₅ | 0.186674 | 年龄与开始脉搏的交互 |
| X₁×X₆ | -0.175921 | 年龄与结束脉搏的交互 |
| X₂×X₃ | -0.129501 | 体重与跑步时间的交互 |
| X₃×X₄ | -0.128494 | 跑步时间与静息脉搏的交互 |
| X₁² | 0.119517 | 年龄的二次效应 |
| X₂×X₅ | 0.094463 | 体重与开始脉搏的交互 |

### 模型统计量

| 统计量 | 数值 | 说明 |
|--------|------|------|
| **σ² (MSE)** | 6.740942 | 误差方差估计 |
| **RMSE** | 2.596332 | 均方根误差 |
| **R²** | **0.9762** | 模型解释了97.6%的变异！ |
| **调整R²** | 0.7625 | 由于参数过多，调整后降至76.3% |

### 二次模型分析

**优点：**
1. **极高的拟合优度**：R² = 0.9762，几乎完美拟合训练数据
2. **捕捉非线性关系**：X₃²显示跑步时间存在二次效应
3. **交互效应显著**：X₁×X₃表明年龄对跑步时间的影响不是独立的

**缺点：**
1. **参数过多**：27个参数对31个观测，自由度仅3
2. **过拟合风险高**：调整R²从0.976降至0.763说明模型复杂度惩罚很大
3. **可解释性差**：交互项和二次项使模型难以直观理解
4. **预测不稳定**：新数据上的表现可能远不如训练数据

**模型比较：**
- 线性完整模型：R² = 0.8480, 调整R² = 0.8100
- 二次完整模型：R² = 0.9762, 调整R² = 0.7625
- **结论**：二次模型虽然拟合更好，但调整R²实际低于线性模型，说明过拟合严重

---

## (d) 二次模型的变量选择

由于27个特征的所有子集数量巨大（2²⁷ ≈ 1.34亿），我们采用贪心前向选择策略。

### 前向选择结果

| 步骤 | 特征数 | R² | AIC | BIC | Cp |
|------|-------|-----|-----|-----|-----|
| 0 | 0 | 0.0000 | 104.70 | 106.13 | 97.30 |
| 1 | 1 | 0.7434 | 64.53 | 67.40 | 5.41 |
| 2 | 2 | 0.7982 | 59.08 | 63.38 | 0.48 |
| **3** | **3** | **0.8291** | **55.93** | **61.67** | **-1.42** |
| 4 | 4 | 0.8390 | 56.08 | 63.25 | -0.67 |
| 5 | 5 | 0.8413 | 57.64 | 66.24 | 1.04 |

### 最优二次模型（BIC准则）

**选择的特征（3个）：**
1. **X₃**（跑步时间）- 线性项
2. **X₁×X₅**（年龄×开始脉搏）- 交互项
3. **X₁×X₆**（年龄×结束脉搏）- 交互项

**模型方程：**
```
Y = 86.5515 - 2.8159×X₃ - 0.0072×(X₁×X₅) + 0.0059×(X₁×X₆)
```

**模型统计量：**
- **R² = 0.8291**
- **调整R² = 0.8101**
- **BIC = 61.67**（最小值）

### 变量选择策略分析

**选择结果的启示：**

1. **X₃（跑步时间）仍然是核心变量**
   - 在二次模型中依然首先被选入
   - 证实其对氧气消耗的主导作用

2. **交互项比二次项更重要**
   - X₁×X₅ 和 X₁×X₆ 被选入，而不是X₃²
   - 说明年龄与脉搏的交互作用有实际意义

3. **简化后的二次模型性能更好**
   - 仅3个特征就达到R² = 0.8291
   - 调整R² = 0.8101，接近完整线性模型

4. **BIC在第3步后开始上升**
   - 表明增加更多特征会导致过拟合
   - 早停策略（early stopping）有效

---

## 最终总结与建议

### 所有模型比较

| 模型 | R² | 调整R² | 特征数 | 优点 | 缺点 |
|------|-----|--------|-------|------|------|
| **线性（完整）** | 0.8480 | 0.8100 | 6 | 平衡性好 | 可能有冗余变量 |
| **线性（BIC选择）** | 0.8368 | 0.8202 | 4 | 简洁有效 | 略损失一些拟合度 |
| **线性（极简）** | 0.7642 | 0.7474 | 2 | 最易解释 | 拟合度略低 |
| **二次（完整）** | 0.9762 | 0.7625 | 27 | 拟合完美 | 严重过拟合 |
| **二次（BIC选择）** | 0.8291 | 0.8101 | 3 | 捕捉交互 | 解释性一般 |

### 关键发现

1. **跑步时间（X₃）是最重要的预测变量**
   - 单变量即可解释74.3%的变异
   - 与氧气消耗呈强负相关（r = -0.8622）
   - 生理学意义明确：有氧能力的直接体现

2. **年龄（X₁）是第二重要的预测变量**
   - 增加约2%的额外解释力
   - 随年龄增长，最大氧气消耗能力下降

3. **脉搏变量存在多重共线性**
   - X₅和X₆相关性高达0.9298
   - 同时包含可能导致系数不稳定

4. **交互效应确实存在但不强**
   - 年龄与脉搏的交互项有一定作用
   - 但增益有限，复杂性增加

### 推荐模型方案

#### 方案一：最佳平衡模型（推荐用于一般预测）
```
Y = β₀ + β₁X₃ + β₂X₁ + β₃X₅ + β₄X₆
```
- **特征**：跑步时间、年龄、开始脉搏、结束脉搏
- **R² = 0.8368**
- **调整R² = 0.8202**
- **优点**：准确性与简洁性的最佳平衡
- **适用**：需要较高预测精度的场景

#### 方案二：极简模型（推荐用于快速评估）
```
Y = 88.46 - 3.20×X₃ - 0.15×X₁
```
- **特征**：仅跑步时间和年龄
- **R² = 0.7642**
- **调整R² = 0.7474**
- **优点**：最易理解和实施，数据收集简单
- **适用**：现场快速评估，或数据有限的情况

#### 方案三：高精度模型（仅推荐用于研究）
```
Y = 86.55 - 2.82×X₃ - 0.007×(X₁×X₅) + 0.006×(X₁×X₆)
```
- **特征**：包含交互项
- **R² = 0.8291**
- **调整R² = 0.8101**
- **优点**：考虑了交互效应
- **适用**：学术研究，深入理解变量关系

### 实际应用建议

1. **初步筛查**：仅测量跑步时间和年龄，使用方案二快速评估
2. **标准评估**：使用方案一，测量4个变量，获得可靠预测
3. **科研用途**：使用方案三，探索更复杂的生理关系

### 模型局限性

1. **样本量较小**（n=31），限制了复杂模型的可靠性
2. **数据仅来自男性**，不能直接推广到女性
3. **多重共线性**可能影响个别系数的稳定性
4. **外推需谨慎**，特别是在数据范围之外

### 变量选择方法比较

- **前向选择**：适合从零开始建立模型
- **后向消元**：适合从完整模型简化
- **两种方法结果高度一致**，增强了结论的可信度

### 模型诊断结论

所有推荐模型的残差分析显示：
- ✓ 残差近似正态分布
- ✓ 残差与拟合值无明显模式
- ✓ 方差齐性假设满足
- ✓ 无明显异常值或高杠杆点

---

## 生成的图表说明

1. **question5_correlation_matrix.png**
   - 相关系数热图
   - 显示所有变量之间的线性关系

2. **question5_part_a_full_model.png**
   - 完整线性模型的诊断图
   - 包含实际vs预测、残差图、Q-Q图、直方图等

3. **question5_part_b_selection.png**
   - 变量选择过程的可视化
   - AIC、BIC、Cp准则的变化趋势

4. **question5_part_c_quadratic.png**
   - 二次模型的诊断图
   - 与线性模型的对比

5. **question5_part_d_quad_selection.png**
   - 二次模型变量选择的过程
   - 最优模型的选择依据

---

## 结论

对于预测氧气消耗量这一问题：

1. **简单模型足够有效**：仅用跑步时间和年龄两个变量，就能解释76%的变异
2. **跑步时间是关键**：这一指标本身就是有氧能力的综合体现
3. **复杂性不一定更好**：二次完整模型虽然拟合完美，但过拟合风险高
4. **实用性优先**：推荐使用4变量的平衡模型（方案一）作为标准预测工具

**最终推荐**：根据BIC准则选择的4变量线性模型，在准确性、可解释性和实用性之间达到最佳平衡。
